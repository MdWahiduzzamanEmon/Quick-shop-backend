// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["omitApi"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMINISTRATOR
  GENERAL_USER
  RETAILER
  SUPPLIER
}

enum WorkerRole {
  RAIDER
  OPERATOR
  REPRESENTATIVE
}

enum user_status {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
  DELETED
}

model User {
  id             String           @id @default(cuid())
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  otherUsers     otherUsers? //only for general user and retailer
  worker         worker? //only for operator, raider, representative
  loggin_history loggin_history[]

  @@index([id])
}

model otherUsers {
  id              String           @id @default(cuid())
  User            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String           @unique
  email           String           @unique
  firstName       String?
  lastName        String?
  username        String           @unique
  mobile          String           @unique
  profile_picture Json             @default("{}")
  password        String
  role            Role             @default(GENERAL_USER)
  isActive        user_status      @default(ACTIVE)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  loggin_history  loggin_history[] //one user can have multiple loggin history

  @@index([userId, email, mobile, username])
  @@map("allUsers")
}

// model for operator, raider, representative

model worker {
  id                  String      @id @default(cuid())
  fullName            String?
  surname             String
  role                WorkerRole  @default(OPERATOR)
  email               String?     @unique
  password            String
  fatherName          String?
  employeeID          String?     @unique @default(cuid())
  whatsapp            String?     @unique
  mobile              String      @unique
  NID                 String?     @unique
  NIDImage            Json        @default("{}")
  education           String?     @default(" ")
  bankName            String?     @default(" ")
  branchName          String?     @default(" ")
  accountNumber       String?     @default(" ")
  mobileBanking       String?     @default(" ")
  mobileBankingNumber String?     @default(" ")
  profile_picture     Json        @default("{}")
  address             String?     @default(" ")
  zipCode             String?     @default(" ")
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  isActive            user_status @default(ACTIVE)
  order               Int         @default(0) //for sorting purpose
  user                User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String      @unique

  @@index([id, employeeID, mobile, NID, accountNumber, mobileBankingNumber, userId, email])
  @@map("workers")
}

//get loggin info

enum loggin_status {
  SUCCESS
  FAILED
}

model loggin_history {
  id           String        @id @default(cuid())
  userId       String
  user         User          @relation(fields: [userId], references: [id])
  ipAddress    String?
  device       String?
  browser      String?
  os           String?
  location     String?
  status       loggin_status
  note         String?
  loginAt      DateTime      @default(now())
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  otherUsers   otherUsers?   @relation(fields: [otherUsersId], references: [id], onDelete: SetNull)
  otherUsersId String?

  @@index([userId, otherUsersId, status]) //indexing for faster search
  @@map("logginInfo") //table name
}
